# ============================================
# SubTracker - Production Docker Compose Override
# ============================================
#
# Usage: docker compose -f docker-compose.yml -f docker-compose.prod.yml up -d
#
# This file overrides docker-compose.yml for production deployments.
# It uses pre-built images from Docker Hub instead of building locally.
#
# ============================================

services:
  # ============================================
  # PostgreSQL Database (Production)
  # ============================================
  db:
    image: adityaubale08/subtracker-db:latest
    restart: always
    environment:
      POSTGRES_DB: ${POSTGRES_DB}
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
    # Don't expose DB port in production
    ports: !reset []
    deploy:
      resources:
        limits:
          memory: 512M
          cpus: '0.5'

  # ============================================
  # Backend - Spring Boot API (Production)
  # ============================================
  backend:
    image: adityaubale08/subtracker-backend:latest
    restart: always
    environment:
      DB_URL: jdbc:postgresql://db:5432/${POSTGRES_DB}
      DB_USERNAME: ${POSTGRES_USER}
      DB_PASSWORD: ${POSTGRES_PASSWORD}
      JWT_SECRET: ${JWT_SECRET}
      JWT_EXPIRATION: ${JWT_EXPIRATION:-86400000}
      MAIL_HOST: ${MAIL_HOST}
      MAIL_PORT: ${MAIL_PORT}
      MAIL_USERNAME: ${MAIL_USERNAME}
      MAIL_PASSWORD: ${MAIL_PASSWORD}
      STRIPE_SECRET_KEY: ${STRIPE_SECRET_KEY}
      FRONTEND_URL: ${FRONTEND_URL}
      CORS_ORIGINS: ${CORS_ORIGINS}
      USD_TO_INR_RATE: ${USD_TO_INR_RATE:-83.0}
      PORT: 8084
    # Don't expose backend port in production (accessed via frontend proxy)
    ports: !reset []
    deploy:
      resources:
        limits:
          memory: 1G
          cpus: '1.0'

  # ============================================
  # Frontend - React + Nginx (Production)
  # ============================================
  frontend:
    image: adityaubale08/subtracker-frontend:latest
    restart: always
    ports:
      - "80:80"
      - "443:443"
    deploy:
      resources:
        limits:
          memory: 256M
          cpus: '0.5'
